"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const core_1 = require("@hapiness/core");
const services_1 = require("../services");
class MongoTestUtils {
    /**
     * Start the mongo deamon
     *
     * @param  {(err?)=>{}} done
     * @returns void
     */
    /* istanbul ignore next */
    static startMongo(done) {
        if (this.spawn) {
            this.spawn.kill();
        }
        this.spawn = require('child_process').spawn('mongod', ['--dbpath', '/tmp']);
        this.spawn.on('error', (err) => {
            done(err);
        });
        setTimeout(() => done(), 1500);
    }
    /**
     * Stop the mongo deamon
     *
     * @param  {(err?)=>{}} done
     * @returns void
     */
    /* istanbul ignore next */
    static stopMongo(done) {
        if (!this.spawn) {
            return;
        }
        this.spawn.kill();
        this.spawn = null;
        setTimeout(() => done(), 1500);
    }
    /**
     * Util to get the Mongoose Model
     * from the root module DI
     *
     * @param  {any} model
     * @returns Model
     */
    /* istanbul ignore next */
    static getDefaultMongooseModel(model) {
        return core_1.Hapiness['module']
            .di
            .get(services_1.MongoClientService)
            .getModel({ adapter: 'mongoose' }, model);
    }
}
exports.MongoTestUtils = MongoTestUtils;
//# sourceMappingURL=test-utils.js.map